/*
 * Wallaby.js - v1.0.1163
 * https://wallabyjs.com
 * Copyright (c) 2014-2021 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of Wallaby.js and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */
var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},__assign.apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,t,i,n){function r(e){return e instanceof i?e:new i(function(t){t(e)})}return new(i||(i=Promise))(function(i,s){function o(e){try{l(n.next(e))}catch(t){s(t)}}function a(e){try{l(n["throw"](e))}catch(t){s(t)}}function l(e){e.done?i(e.value):r(e.value).then(o,a)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return n([e,t])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,s&&(o=2&i[0]?s["return"]:i[0]?s["throw"]||((o=s["return"])&&o.call(s),0):s.next)&&!(o=o.call(s,i[1])).done)return o;switch(s=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,s=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(n){i=[6,n],s=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,s,o,a,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},__read=this&&this.__read||function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,s=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(a){r={error:a}}finally{try{n&&!n.done&&(i=s["return"])&&i.call(s)}finally{if(r)throw r.error}}return o},__spreadArray=this&&this.__spreadArray||function(e,t,i){if(i||2===arguments.length)for(var n,r=0,s=t.length;r<s;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))},path=require("path"),fs=require("fs"),crypto=require("crypto"),tracer=global.$_$tracer,workerId=tracer.workerId,utils=tracer._utils,localProjectRoot=path.dirname(global.wallaby._localNodeModules),originalCacheRoot=global.wallaby._originalCacheRoot,jasmineInitializerPath=path.join(__dirname,"jasmineInitializer.js"),jestRuntime,jestConfig,createTestScheduler,jestRunGlobalHook,prettyFormat;process.env.VUE_CLI_BABEL_TRANSPILE_MODULES=!0,process.env.BABEL_ENV||(process.env.BABEL_ENV="test"),process.env.NODE_ENV||(process.env.NODE_ENV="test"),process.env.PUBLIC_URL="",process.env.JEST_WORKER_ID=workerId;var utilsLazyLoadDependencyReplacement=fs.existsSync(path.join(localProjectRoot,"node_modules/mock-fs"))?function(){return[]}:utils.lazyLoadDependencyReplacement;utils.patchModulesCode([{files:["@jest/transform/build/ScriptTransformer.js"],replacements:[{from:"const getScriptCacheKey = (filename, instrument) => {",to:"const getScriptCacheKey = (filename, instrument) => { var wallabyKey = global.$_$tracer._fileCacheKey(filename); if (wallabyKey) return wallabyKey;"},{from:"constructor(config) {",to:"constructor(config) { var _getTransformer = this._getTransformer; this._getTransformer = function(filename) { var transformer = _getTransformer.apply(this, arguments); return global.$_$tracer._extendJestTransformer ? global.$_$tracer._extendJestTransformer(filename, transformer) : transformer; };",optional:!0},{from:"this._config = _config;",to:"this._config = _config; var _getTransformer = this._getTransformer; this._getTransformer = function(filename) { var transformer = _getTransformer.apply(this, arguments); return global.$_$tracer._extendJestTransformer ? global.$_$tracer._extendJestTransformer(filename, transformer) : transformer; };",optional:!0},{from:"!!this._config.transform && !!this._config.transform.length && !isIgnored",to:"!isIgnored",optional:!0},{from:"this._config.transform.length !== 0 && !isIgnored",to:"!isIgnored",optional:!0},{from:"transform(filename, options, fileSource) {",to:"transform(filename, options, fileSource) { var wallabyFileId = global.$_$tracer._fileId(filename); if (wallabyFileId) { global.$_$tracer.programScopeStartLoading(wallabyFileId); }"},{from:"transformAsync(filename, options, fileSource) {",to:"transformAsync(filename, options, fileSource) { var wallabyFileId = global.$_$tracer._fileId(filename); if (wallabyFileId) { global.$_$tracer.programScopeStartLoading(wallabyFileId); }",optional:!0},{from:"invariant(name);",to:"",optional:!0}]},{files:["@jest/core/build/jest.js"],replacements:[{from:"'use strict';",to:"'use strict'; exports.runGlobalHook = _interopRequireDefault(require('./runGlobalHook'));"}]},{files:["jest-resolve/build/defaultResolver.js"],replacements:[{from:"const checkedPaths = new Map();",to:"const checkedPaths = new Map(); checkedPaths.get = function() {};"}]},{files:["jest-message-util/build/index.js"],replacements:[{from:"${renderedCallsite}\\n${stacktrace}",to:"${stacktrace}"}]},{files:["vue-jest/lib/process.js"],replacements:[{from:"return { code: output }",to:"return { code: output, scriptSrc: parts.script && parts.script.src }",optional:!0},{from:"code: output.code,",to:"code: output.code, scriptSrc: descriptor.script && descriptor.script.src,",optional:!0},{from:"const { descriptor } = parse(src)",to:"const { descriptor } = parse(src, { pad: true })",optional:!0}]},{files:["react-app-rewired/scripts/test.js"],replacements:[{from:"if (paths.customScriptsIndex > -1) {",to:"module.exports = config; return; if (paths.customScriptsIndex > -1) {"}]},{files:["jest-snapshot/build/inline_snapshots.js","jest-snapshot/build/InlineSnapshots.js"],replacements:[{from:"_callee$property$loc$.column",to:"0",optional:!0},{from:"${column - 1}",to:"0",optional:!0},{from:"const {line, column} = callee.property.loc.start;",to:"const {line } = callee.property.loc.start; const column = 0;",optional:!0},{from:"const snapshotsByFile = groupSnapshotsByFile(snapshots);",to:"global.$_$tracer._remapInlineSnapshots(snapshots); const snapshotsByFile = groupSnapshotsByFile(snapshots);"}]},{files:["jest-snapshot/build/State.js"],replacements:__spreadArray(__spreadArray([{from:"const pass = expected === receivedSerialized;",to:"const pass = expected === receivedSerialized; global.$_$tracer._matchSnapshot({key, snapshotPath: this._snapshotPath});"},{from:"hasSnapshot && this._updateSnapshot === 'all'",to:"hasSnapshot && (!global.$_$tracer._updateNoMoreThanOneSnapshotPerTestFileRun || !pass && (this.updated === 0)) && this._updateSnapshot === 'all'"},{from:"this._updateSnapshot === 'all' && this._uncheckedKeys.size",to:"this._updateSnapshot === 'all' && (!global.$_$tracer._updateNoMoreThanOneSnapshotPerTestFileRun || (this.updated === 0)) && this._uncheckedKeys.size"}],__read(utilsLazyLoadDependencyReplacement("_InlineSnapshots","./InlineSnapshots")),!1),__read(utilsLazyLoadDependencyReplacement("_jestMessageUtil","jest-message-util")),!1)},{files:["jest-jasmine2/build/jasmine/Env.js","expect/build/toThrowMatchers.js"],replacements:__spreadArray([],__read(utilsLazyLoadDependencyReplacement("_jestMessageUtil","jest-message-util")),!1)},{files:["jest-matcher-utils/build/index.js"],replacements:__spreadArray([],__read(utilsLazyLoadDependencyReplacement("_jestDiff","jest-diff",{dependencyOverride:"_interopRequireWildcard(require('jest-diff'))",replaceBothDependencyAndDependencyOverride:!0})),!1)},{files:["@testing-library/jest-dom/dist/to-be-checked.js","@testing-library/dom/dist/queries/role.js"],replacements:utilsLazyLoadDependencyReplacement("_ariaQuery","aria-query",{doubleQuotes:!0})},{files:["@testing-library/dom/dist/role-helpers.js"],replacements:__spreadArray(__spreadArray([],__read(utilsLazyLoadDependencyReplacement("_ariaQuery","aria-query",{doubleQuotes:!0})),!1),__read(utilsLazyLoadDependencyReplacement("elementRoleList",void 0,{dependencyOverride:"buildElementRoleList(_ariaQuery().elementRoles)",varType:"const"})),!1)},{files:["@testing-library/dom/dist/pretty-dom.js"],replacements:utilsLazyLoadDependencyReplacement("_getUserCodeFrame","./get-user-code-frame",{doubleQuotes:!0})},{files:["ts-jest/dist/config/config-set.js"],replacements:[{from:"this._overriddenCompilerOptions = {",to:"this._overriddenCompilerOptions = { sourceMap: true, "}]},{files:["ts-jest/dist/compiler.js"],replacements:[{from:"getScriptVersion: function (fileName) {",to:'getScriptVersion: function (fileName) { fileName = require("path").normalize(fileName);'},{from:"getScriptSnapshot: function (fileName) {",to:'getScriptSnapshot: function (fileName) { fileName = require("path").normalize(fileName);'}]},{files:["jest-runner/build/index.js"],replacements:[{from:"process.env.JEST_WORKER_ID = '1';",to:""}]},{files:["jest-jasmine2/build/jasmine/Env.js"],replacements:[{from:"oldListenersException = process",to:"oldListenersException = (j$.process || process)"},{from:"oldListenersRejection = process",to:"oldListenersRejection = (j$.process || process)"}]},{files:["jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js"],replacements:[{from:"(0, _state.addEventHandler)(eventHandler);",to:"(0, _state.addEventHandler)(eventHandler); (0, _state.addEventHandler)(new global.$_$tracer.CircusReporter(global.$_$tracer).handler);"},{from:"testNamePattern: globalConfig.testNamePattern",to:"testNamePattern: globalConfig.testNamePattern, testPath"}]},{files:["jest-circus/build/run.js"],replacements:[{from:"(hasFocusedTests && test.mode !== 'only') ||",to:"(hasFocusedTests && test.mode !== 'only') || (global.$_$tracer.jestCircusSkipTest && global.$_$tracer.jestCircusSkipTest(test)) || "}]},{files:["jest-circus/build/eventHandler.js"],replacements:[{from:"case 'error': {",to:"case 'error': {\n          if (state.currentlyRunningTest && state.currentlyRunningTest._reject) {\n            state.currentlyRunningTest._reject(event.error);\n            delete state.currentlyRunningTest._reject;\n            break;\n          }"}]},{files:["jest-circus/build/utils.js"],replacements:[{from:"(hasFocusedTests && child.mode !== 'only') ||",to:"(hasFocusedTests && child.mode !== 'only') || (global.$_$tracer.jestCircusSkipTest && global.$_$tracer.jestCircusSkipTest(child)) || "},{from:"timeoutID = setTimeout(",to:"testOrHook._reject = reject;timeoutID = setTimeout("},{from:"clearTimeout(timeoutID);",to:"clearTimeout(timeoutID);delete testOrHook._reject;"}]},{files:["jest-util/build/setGlobal.js"],replacements:[{from:"globalToMutate[key] = value;",to:"globalToMutate[key] = value;\n             if (globalToMutate.$_$wp) return;\n             if (!globalToMutate.regeneratorRuntime && global.regeneratorRuntime) {\n              globalToMutate.regeneratorRuntime = global.regeneratorRuntime;\n             }\n             globalToMutate.$_$wp = global.$_$wp;\n             globalToMutate.$_$wpe = global.$_$wpe;\n             globalToMutate.$_$w = global.$_$w;\n             globalToMutate.$_$w_ = global.$_$w_;\n             globalToMutate.$_$wf = global.$_$wf;\n             globalToMutate.$_$wv = global.$_$wv;\n             globalToMutate.$_$tracer = global.$_$tracer;\n             globalToMutate.nodeGlobal = global;\n             global.$_$tracer.setEnvGlobal(globalToMutate);\n             globalToMutate.$_$tracer._jasmineAdapter = new global.$_$tracer.JasmineReporter(global.$_$tracer);\n        "}]},{files:["jest-util/build/tryRealpath.js"],replacements:[{from:"path = _gracefulFs().realpathSync.native(path);",to:"const newPath = _gracefulFs().realpathSync.native(path);\n        path = (process.platform === 'win32' && path.substr(0, 1).toLowerCase() !== newPath.substr(0, 1).toLowerCase()) ? path : newPath;"}]}],"Possibly incompatible/unsupported Jest version");var CircusReporter=function(e){var t,i,n=global.$_$session,r=e.initialSpecId(),s=function(e){var t=[],i=e;do t.unshift(i.name);while(i=i.parent);return t.shift(),t};e.jestCircusSkipTest=function(t){return!!e.hasSpecFilter()&&!e.specFilter(s(t))};var o=function(e){var t=s(e);return t.pop(),t},a=function(e){return s(e).filter(function(e){return!e}).join(" ")};this.handler=function(s){if(n===global.$_$session)if("setup"===s.name)i=e._fileId(s.testPath);else if("run_finish"===s.name)global.$_$initialSpecId=r+1;else if("run_start"===s.name)e.started({total:"unknown number of"});else if("test_start"===s.name)r++,e.specStart(r,a(s.test));else if("test_fn_start"===s.name)e.specSyncStart(),t=(new e._Date).getTime();else if("test_todo"===s.name){e.specSyncEnd();var l=e.specEnd();e.result({id:r,timeRange:l,name:s.test.name,suite:o(s.test),status:"todo",time:0,testFile:i})}else if("test_skip"===s.name){e.specSyncEnd();var l=e.specEnd();e.jestCircusSkipTest(s.test)||e.result({id:r,timeRange:l,name:s.test.name,suite:o(s.test),status:"skipped",time:0,testFile:i})}else if("test_done"===s.name){e.specSyncEnd();for(var l=e.specEnd(),c={id:r,timeRange:l,name:s.test.name,suite:o(s.test),status:"executed",time:(new e._Date).getTime()-t,log:[],testFile:e.entryFile()},u=0;u<s.test.errors.length;u++){var h=s.test.errors[u];Array.isArray(h)&&(h[0]&&("string"==typeof h[0].stack||h[0].message)?h=h[0]:(h[1].message="thrown: "+prettyFormat()(h[0],{maxDepth:3}),h=h[1]));var p={error:h,passed:!1};p.message=h?h.name&&h.message?h.name+": "+h.message:h.toString():"empty error",p.stack=h?h.stack:null,p.message&&0===p.message.indexOf("Error: expect(")&&(p.message=p.message.replace("Error: ","")),p.error.matcherResult?(p.matcherName=p.error.matcherResult.name,p.actual=p.error.matcherResult.actual,p.expected=p.error.matcherResult.expected):(p.showDiff=p.error.showDiff,p.actual=p.error.actual,p.expected=p.error.expected),p.showDiff=p.showDiff||"toEqual"===p.matcherName||"toBe"===p.matcherName||"toMatchSnapshot"===p.matcherName||"toMatchInlineSnapshot"===p.matcherName||"toThrowErrorMatchingSnapshot"===p.matcherName,c.log.push(e.setAssertionData(p,{message:p.message||"",stack:p.stack}))}c.log.length||delete c.log,e.result(c)}}},JasmineReporter=function(e){var t=global.$_$session,i=e.initialSpecId(),n=[],r=function(){return t!==global.$_$session};this.jasmineDone=function(){r()||(global.$_$initialSpecId=i+1)},this.jasmineStarted=function(){r()||e.started({total:"unknown number of"})},this.suiteStarted=function(e){r()||n.push(e.description)},this.suiteDone=function(){r()||n.pop()},this.specStarted=function(t){r()||(t._id=++i,e.specStart(t._id,t.fullName),t._time=(new e._Date).getTime())},this.specDone=function(t){if(!r()){var i=e.specEnd(),s="passed"===t.status,o="disabled"===t.status||"pending"===t.status||"todo"===t.status,a=o?"pending"===t.status?"skipped":"todo"===t.status?"todo":"disabled"===t.status?"disabled":"executed":"executed",l={id:t._id,timeRange:i,name:t.description,suite:n.slice(),status:a,time:o?0:(new e._Date).getTime()-t._time,log:[],testFile:t._testFile};if(!s&&!o)for(var c=t.failedExpectations,u=0;u<c.length;u++){var h=c[u];if(h.error){if(h.message&&0===h.message.indexOf("Error: expect(")){var p=h.message.split("\n");p.shift(),p[0]&&0!==p[0].length||p.shift(),h.message=p.join("\n")}h.error.matcherResult?(h.matcherName=h.error.matcherResult.name,h.actual=h.error.matcherResult.actual,h.expected=h.error.matcherResult.expected):(h.showDiff=h.error.showDiff,h.actual=h.error.actual,h.expected=h.error.expected)}h.showDiff=h.showDiff||"toEqual"===h.matcherName||"toBe"===h.matcherName||"toMatchSnapshot"===h.matcherName||"toMatchInlineSnapshot"===h.matcherName||"toThrowErrorMatchingSnapshot"===h.matcherName,l.log.push(e.setAssertionData(h,{message:h.message,stack:h.stack}))}l.log.length||delete l.log,e.result(l)}}};tracer.JasmineReporter=JasmineReporter,tracer.CircusReporter=CircusReporter;var WallabyRunner=function(){function e(e){this._sessionId=e,this._runComplete=!1}return e.prototype.onRunStart=function(){},e.prototype.onTestStart=function(){},e.prototype.isActive=function(){return this._sessionId===global.$_$session},e.prototype.getLastError=function(){return this._error},e.prototype._setError=function(e){this._error=e},e.prototype.completeRun=function(e){!this._runComplete&&this.isActive()&&(this._runComplete=!0,tracer.resetEnvGlobal(),tracer.complete(e))},e.prototype.onTestResult=function(e,t){t.testExecError&&this.isActive()&&(tracer.reportGlobalErrorObject(__assign(__assign({},t.testExecError),{message:t.testExecError.message,stack:t.testExecError.stack,testFilePath:t.testFilePath})),this.completeRun())},e.prototype.onRunComplete=function(e,t){!tracer.canUpdateSnapshots()&&t&&t.testResults&&t.testResults.forEach&&t.testResults.forEach(function(e){if(e&&e.snapshot&&e.snapshot.unchecked){var t=e.snapshot.unchecked+" snapshot"+(e.snapshot.unchecked>1?"s":"")+" obsolete "+(e.snapshot.uncheckedKeys&&"\n\t"+e.snapshot.uncheckedKeys.join("\n\t")||"");tracer.reportGlobalErrorObject({message:t,stack:t+"\n    at "+e.testFilePath+":1:0",snapshot:!0,allowNotMappedStackLines:!0})}}),this.completeRun()},e}(),initializeJest=function(){return __awaiter(void 0,void 0,void 0,function(){var e,t,i,n,r,s,o,a,l,c,u;return __generator(this,function(h){switch(h.label){case 0:return[4,utils.loadJest(localProjectRoot,global.wallaby._testFrameworkPath,global.wallaby._testConfigFile)];case 1:if(e=h.sent()||{},t=e.jestCLI,i=e.jestConfigLoader,jestConfig=global.wallaby.customJestConfig||e.jestConfig,!t)throw new Error("Can not find jest-cli module");if(!jestConfig)throw new Error("Can not load jest config");if(!i)throw new Error("Can not find jest-config module");if(jestRuntime=utils.tryRequireModuleWithPathFrom(i.path,"jest-runtime",1),!jestRuntime)throw new Error("Can not find Jest runtime module");if(n=utils.tryRequireModuleWithPathFrom(t.path,"@jest/core"),!n)throw new Error("Can not find Jest core module");if(prettyFormat=function(){return r||(r=utils.tryRequireModuleWithPathFrom(i.path,"pretty-format",1).module),r},s=n.module.TestScheduler,createTestScheduler=s?function(e){return new s(e)}:n.module.createTestScheduler,!createTestScheduler)throw new Error("Can not find Jest test scheduler module");return o=utils.tryRequireModuleWithPathFrom(t.path,"@jest/reporters"),o?(a=function(e,t){var i=e.prototype;i.log=i._write=t?function(){}:function(e){console.log("Jest: "+e+"\n")}},a(o.module.BaseReporter),a(o.module.DefaultReporter),a(o.module.SummaryReporter,!0)):console.warn("Can not find Jest reporters module"),jestRunGlobalHook=n.module.runGlobalHook?{module:n.module.runGlobalHook["default"]||n.module.runGlobalHook}:utils.tryRequireModuleWithPathFrom(t.path,"@jest/core/build/runGlobalHook"),jestRunGlobalHook||console.warn("Can not find Jest run global hook module"),l=utils.tryRequireModuleWithPathFrom(t.path,"@jest/console"),l?(c=function(e){var t=e.prototype;["log","warn","error","dir","debug","info"].forEach(function(e){var i=t[e];i&&(t[e]=function(){return tracer._suppressConsoleLog||tracer["_"+e].apply(tracer,arguments),i.apply(this,arguments)})})},c(l.module.BufferedConsole),c(l.module.CustomConsole),c(l.module.NullConsole)):console.warn("Can not find Jest console module"),jestConfig.configs=(jestConfig.configs||[]).filter(function(e){return"jest-runner"===e.runner||~utils.normalizePath(e.runner||"").indexOf("node_modules/jest-runner/")||"jest-runner-groups"===e.runner||~utils.normalizePath(e.runner||"").indexOf("node_modules/jest-runner-groups/")}),jestConfig.configs.forEach(function(e){if(e.bail=0,e.notify=0,e.collectCoverage=!1,e.collectCoverageFrom=e.collectCoverageFrom||(jestConfig.globalConfig||{}).collectCoverageFrom,e.collectCoverageFrom&&e.collectCoverageFrom.length||(e.collectCoverageFrom=["**/*."+(1===e.moduleFileExtensions.length?e.moduleFileExtensions[0]:"{"+e.moduleFileExtensions.join(",")+"}")]),e.coveragePathIgnorePatterns=e.coveragePathIgnorePatterns&&e.coveragePathIgnorePatterns.map(function(e){return new RegExp(e)}),e.errorOnDeprecated=!1,e.setupFilesAfterEnv=e.setupFilesAfterEnv||[],e.transformIgnorePatterns=e.transformIgnorePatterns||[],e.testRunner.indexOf("jest-circus")!==-1){if(void 0!==process.env.WALLABY_JEST_CIRCUS&&(!process.env.WALLABY_JEST_CIRCUS||"false"===process.env.WALLABY_JEST_CIRCUS)){var t=e.testRunner.replace("jest-circus/runner","jest-jasmine2/build/index").replace("jest-circus\\runner","jest-jasmine2\\build\\index");try{e.testRunner=require.resolve("jest-jasmine2",{paths:[localProjectRoot]})}catch(i){e.testRunner=void 0}e.testRunner||(e.testRunner=t),e.setupFilesAfterEnv.unshift(jasmineInitializerPath),e.transformIgnorePatterns.push(utils.replacePathSepForRegex(path.join(path.basename(path.dirname(jasmineInitializerPath)),path.basename(jasmineInitializerPath))))}}else e.setupFilesAfterEnv.unshift(jasmineInitializerPath),e.transformIgnorePatterns.push(utils.replacePathSepForRegex(path.join(path.basename(path.dirname(jasmineInitializerPath)),path.basename(jasmineInitializerPath))));if(e.verbose=null,delete e.watchPlugins,delete e.testResultsProcessor,delete e.reporters,e.globals=e.globals||{},e.globals["ts-jest"]=e.globals["ts-jest"]||{},e.globals["ts-jest"].diagnostics!==!0&&(e.globals["ts-jest"].diagnostics=!1),e.resolver){var n=path.join("node_modules","@nrwl","jest","plugins","resolver.js");if(e.resolver.endsWith(n)){var r=path.dirname(path.dirname(path.dirname(path.dirname(path.dirname(e.resolver))))),s=path.join(r,"angular.json"),o=path.join(r,"workspace.json"),a=fs.existsSync(s)?s:fs.existsSync(o)?o:void 0;if(a&&fs.statSync(a)){var l=path.relative(r,e.rootDir).replace(/\\/,"/");try{var c=JSON.parse(fs.readFileSync(a).toString()),u=Object.keys(c.projects).map(function(e){return __assign({},c.projects[e])}).filter(function(e){return e.root===l}).filter(function(e){return e.architect&&e.architect.test&&"@nrwl/jest:jest"===e.architect.test.builder}).map(function(e){return e.architect.test.options});if(1===u.length){var h=u[0].tsConfig,p=u[0].setupFile;h&&(e.globals["ts-jest"].tsConfig="<rootDir>/"+path.relative(l,h)),p&&e.setupFilesAfterEnv.push(path.resolve(r,p)),e.globals["ts-jest"].stringifyContentPathRegex="\\.html$",a===s&&(utils.tryRequireModuleWithPathFrom(localProjectRoot,"jest-preset-angular/InlineHtmlStripStylesTransformer")?e.globals["ts-jest"].astTransformers=["jest-preset-angular/InlineHtmlStripStylesTransformer"]:utils.tryRequireModuleWithPathFrom(localProjectRoot,"jest-preset-angular/build/InlineFilesTransformer")&&(e.globals["ts-jest"].astTransformers=["jest-preset-angular/build/InlineFilesTransformer","jest-preset-angular/build/StripStylesTransformer"]))}}catch(i){}}}}}),u=jestConfig.globalConfig,u.notify=!1,u.bail=0,u.collectCoverage=!1,u.detectLeaks=!1,u.detectOpenHandles=!1,u.errorOnDeprecated=!1,u.json=!1,u.maxWorkers=1,u.useStderr=!1,u.watch=!1,u.verbose=null,process.env.NO_WATCHMAN&&(u.watchman=!1),delete u.findRelatedTests,delete u.listTests,delete u.forceExit,delete u.onlyChanged,delete u.onlyFailures,delete u.outputFile,delete u.passWithNoTests,delete u.watchAll,delete u.watchPlugins,delete u.testResultsProcessor,delete u.reporters,[2]}})})},testRunner,testFiles,testContexts,testFilesByPath,noopTestWatcher={setState:function(){},isInterrupted:function(){return!1},isWatchMode:function(){return!1}},configure=function(e){return __awaiter(void 0,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return t=global.$_$session,testRunner?[2,testRunner]:[4,initializeJest()];case 1:return i.sent(),e&&jestConfig.configs.forEach(function(t){Object.keys(e).forEach(function(i){"bail"!==i&&"notify"!==i&&"collectCoverage"!==i&&"errorOnDeprecated"!==i&&"testRunner"!==i&&"verbose"!==i&&"watchPlugins"!==i&&("setupFilesAfterEnv"===i||"transformIgnorePatterns"===i?t[i]=t[i].concat(e[i]):t[i]=e[i])})}),[4,Promise.all(jestConfig.configs.map(function(e){return jestRuntime.module.createContext(e,{maxWorkers:jestConfig.globalConfig.maxWorkers,watchman:jestConfig.globalConfig.watchman})}))];case 2:return testContexts=i.sent(),t!==global.$_$session?[2]:[4,createTestScheduler(jestConfig.globalConfig)];case 3:return testRunner=i.sent(),[2,testRunner]}})})},getTestData=function(e){return e.map(function(e){return{path:e,context:testContexts.length>1?testContexts.filter(function(t){return!(t.config.testMatch&&t.config.testMatch.length&&!t.config.testMatch.some(function(t){return utils.pathMatchesPattern(e,t,{micromatch:!0})}))}).reduce(function(t,i){e&&(e=e.normalize());var n=e.replace((i.config.rootDir||"").normalize(),"").length;return t?t.relativePathLength>n?{context:i,relativePathLength:n}:t:{context:i,relativePathLength:n}},void 0).context:testContexts[0]}})},globalSetupTeardown=function(e,t){return __awaiter(void 0,void 0,void 0,function(){var i,n,r,s,o,a;return __generator(this,function(l){switch(l.label){case 0:i={},l.label=1;case 1:l.trys.push([1,3,,4]);try{global.wallaby.processEnv||(global.wallaby.processEnv=JSON.parse(JSON.stringify(process.env))),i=global.wallaby.processEnv}catch(c){return tracer.reportGlobalError("Failed to serialize existing process.env: "+(c&&c.message||"")),e.completeRun(),[2]}return[4,jestRunGlobalHook.module({allTests:t,globalConfig:jestConfig.globalConfig,moduleName:"globalSetup"})];case 2:return l.sent(),[3,4];case 3:return n=l.sent(),tracer.reportGlobalError("Failed to run jest globalSetup: "+(n&&n.message||"")),e.completeRun(),[2];case 4:r={};try{s=JSON.parse(JSON.stringify(process.env)),o=Object.keys(s).filter(function(e){return void 0===i[e]||i[e]!==s[e]}).map(function(e){return{variable:e,value:s[e]}}),a=Object.keys(i).filter(function(e){return void 0===s[e]}),r={updates:o,deletions:a}}catch(c){return tracer.reportGlobalError("Failed to serialize process.env: "+(c&&c.message||"")),e.completeRun(),[2]}return tracer.globalSetupComplete(r),global.wallaby.teardown=function(){return __awaiter(void 0,void 0,void 0,function(){var i;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,jestRunGlobalHook.module({allTests:t,globalConfig:jestConfig.globalConfig,moduleName:"globalTeardown"})];case 1:return n.sent(),e.completeRun(),[3,3];case 2:return i=n.sent(),tracer.reportGlobalError("Failed to run jest globalTeardown: "+(i&&i.message||"")),e.completeRun(),[2];case 3:return[2]}})})},[2]}})})};tracer.start(function(){return __awaiter(void 0,void 0,void 0,function(){var e,t,i,n,r,s;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,8,,9]),testFilesByPath=void 0,e=global.$_$session,t=new WallabyRunner(e),[4,configure()];case 1:return i=o.sent(),i&&t.isActive()?(i.removeReporter(WallabyRunner),i.addReporter(t),n=getTestData(testFiles),global.wallaby.runGlobals?[4,globalSetupTeardown(t,n)]:[3,3]):[2];case 2:return o.sent(),[3,7];case 3:return o.trys.push([3,5,6,7]),jestConfig.globalConfig.updateSnapshot=tracer.canUpdateSnapshots()?"all":process.env.CI?"none":"new",t.isActive()?(tracer.debugLog("Scheduling Jest Test Run ("+e+"): "+(new Date).toISOString()),[4,i.scheduleTests(n,noopTestWatcher)]):[2];case 4:return o.sent(),[3,7];case 5:return r=o.sent(),tracer.debugLog("Jest Test Error: "+(new Date).toISOString()),r&&console.error(r.stack),[3,7];case 6:return tracer.debugLog("Jest Test Run Complete ("+e+"): "+(new Date).toISOString()),t.completeRun(),[7];case 7:return[3,9];case 8:return s=o.sent(),tracer.reportGlobalError("Failed to initialize wallaby jest.\n"+(s&&s.message||"")+"\n"+(s&&s.stack||"")),[3,9];case 9:return[2]}})})});var getFileData=function(e){var t=global.wallaby.localProjectDir,i=global.wallaby.projectCacheDir,n=utils.normalizePath(e.replace(t,"").replace(i,""));return"/"===n[0]&&(n=n.substr(1)),tracer._filePathToFileData[n]},initializeTestsByFilePath=function(){testFilesByPath||(testFilesByPath={},global.$_$testFiles.forEach(function(e){testFilesByPath[e.path]=e}))};tracer._fileCacheKey=function(e){var t=getFileData(e);if(t){var i=t.path+"_"+workerId+"_"+t.id+"_"+t.ts;if(t.childFilePath){var n=getFileData(t.childFilePath);n&&(i+="_"+n.id+"_"+n.ts)}return i}},tracer._fileId=function(e){var t=getFileData(e);if(t)return t.id},tracer._remapInlineSnapshots=function(e){initializeTestsByFilePath(),e.forEach(function(e){if(e.frame){var t=testFilesByPath[path.normalize(e.frame.file)];t&&t.lineMap&&(e.frame.line=utils.getOriginalLineByGeneratedLine(t.lineMap,e.frame.line,e.frame.column)||e.frame.line,e.frame.column=1)}})},tracer._matchSnapshot=function(e){var t=e.key,i=e.snapshotPath;if(tracer._expectedMatchSnapshotCall){var n=__read(tracer._expectedMatchSnapshotCall,2),r=n[0],s=n[1];delete tracer._expectedMatchSnapshotCall,tracer._matchSnapshotCalls||(tracer._matchSnapshotCalls=[]),tracer._matchSnapshotCalls.push({fileId:r,snapshotCallRangeId:s,snapshotKey:t,snapshotPath:utils.normalizePath(path.relative(localProjectRoot,i))})}},tracer._beforeMatchSnapshot=function(e,t){tracer._expectedMatchSnapshotCall=[e,t]};var readFileSync=fs.readFileSync;fs.readFileSync=function(e){var t=getFileData(e);return t&&t.inOriginalFilesCache&&(arguments[0]=path.join(originalCacheRoot,t.path)),readFileSync.apply(this,arguments)};var writeFileSync=fs.writeFileSync;fs.writeFileSync=function(e,t){if(e.endsWith(".snap"))return writeFileSync.apply(this,arguments);var i=getFileData(e);if(!i)return writeFileSync.apply(this,arguments);var n=(new Error).stack.toLowerCase();if(n.indexOf("jest-snapshot")===-1||n.indexOf("inline")===-1)return writeFileSync.apply(this,arguments);var r=i.inOriginalFilesCache?path.join(originalCacheRoot,i.path):e,s=readFileSync(r).toString(),o=t.toString();tracer.sendFileChange({id:i.id,oldContent:s,newContent:o})},tracer._extendJestTransformer=function(e,t){var i=getFileData(e);if(!i||!i.instrument)return t;var n=function(e,t,i){return!!e.test||!(i.coveragePathIgnorePatterns||[]).some(function(e){return utils.pathMatchesPattern(t,e,{absolute:!0})})&&(".node"!==path.extname(t)&&".json"!==path.extname(t)&&!i.collectCoverageFrom.some(function(t){return"!"===t[0]&&!utils.pathMatchesPattern(e.path,t,{micromatch:!0})})&&i.collectCoverageFrom.some(function(t){return"!"!==t[0]&&utils.pathMatchesPattern(e.path,t,{micromatch:!0})}))},r=function(e){e.transformer&&(e.getCacheKey=e.transformer.getCacheKey,e.process=e.transformer.process,e.getCacheKeyAsync=e.transformer.getCacheKeyAsync,e.processAsync=e.transformer.processAsync),e.getCacheKey||e.getCacheKeyAsync||(e.getCacheKey=function(e,t,i,n){return"string"!=typeof i&&(n=i,i=n.configString),crypto.createHash("md5").update(e).update(i).update(n&&n.instrument?"instrument":"").update(t).digest("hex")});var t=function(e,t,i,n,r){var s=getFileData(t);if(s&&(!global.$_$coverage||global.$_$coverage[s.id]||s.originalTs||(s.originalTs=s.ts,s.ts=+new Date),r+="_"+s.id+"_"+workerId+"_"+s.ts+(global.wallaby.runGlobals?"_1":""),s.childFilePath)){var o=getFileData(s.childFilePath);o&&(r+="_"+o.id+"_"+o.ts)}return r};if(e.getCacheKey&&!e.getCacheKey._wallabyExtended){var i=e.getCacheKey;e.getCacheKey=function(n,r,s,o){var a=i.call(e,n,r,s,o);return t(n,r,s,o,a)},e.getCacheKey._wallabyExtended=!0}if(e.getCacheKeyAsync&&!e.getCacheKeyAsync._wallabyExtended){var r=e.getCacheKeyAsync;e.getCacheKeyAsync=function(i,n,s,o){return __awaiter(this,void 0,void 0,function(){var a;return __generator(this,function(l){switch(l.label){case 0:return[4,r.call(e,i,n,s,o)];case 1:return a=l.sent(),[2,t(i,n,s,o,a)]}})})},e.getCacheKeyAsync._wallabyExtended=!0}var s=function(e,t,i,r,s){i=i.config||i;var o=!0;s&&null===s.code&&(s.code=e,o=!1);var a;s&&s.scriptSrc&&(a=getFileData(t),a&&(t=path.join(t,"..",s.scriptSrc)),delete s.scriptSrc);var l=getFileData(t);if(l&&!global.wallaby.runGlobals&&n(l,t,i)){var c=l.id;"string"==typeof s?s={code:s,map:utils.getSourceMapFromCode(s)}:o&&"string"==typeof s.code&&!s.map&&(s.map=utils.getSourceMapFromCode(s.code)),"string"==typeof s.map&&(s.map=JSON.parse(s.map)),s.map&&s.map.constructor&&"SourceMapGenerator"===s.map.constructor.name&&(s.map=JSON.parse(s.map.toString()));var u=s.code,h=_.extend({},global.$_$tracer._hints);
l.test&&(h.allowIgnoringCoverageInTests||(h=_.omit(h,"ignoreCoverage","ignoreCoverageForFile"))),h=_.omit(h,"testFileSelection");var p=s.map&&(l.changeStart||l.virtualLogs&&l.virtualLogs.length||l.test)&&new utils.SourceMapConsumer(s.map),f=utils.mapTextPosition(l.changeStart&&l.changePosition,p),d=l.virtualLogs||[],g=void 0;try{g=utils.instrument(u,{file:c,test:l.test,fileName:path.basename(l.path),testFileChangeStart:f,hints:h,recordValues:global.$_$tracer._autoConsoleLog,recordMatchSnapshotRanges:!0,preserveComments:global.$_$tracer._preserveComments,virtualLogs:d.map(function(e){return{originalRange:e.range,range:utils.mapOriginalRangeToTransformed(p,e.range),changeId:e.id,traceId:e.traceId,expanded:e.expanded,"new":e["new"]}})})}catch(v){throw utils.formatInstrumentationError(v,u,l.path)}if(g.liveCommentLines&&s.map?(p||(p=new utils.SourceMapConsumer(s.map)),g.liveCommentLines=Object.keys(g.liveCommentLines).map(function(e){return parseInt(e,10)}).map(function(e){return utils.mapTransformedRangeToOriginal(p,[e,1,e,1])}).filter(function(e){return e&&e.length}).map(function(e){return e[0]})):g.liveCommentLines&&(g.liveCommentLines=Object.keys(g.liveCommentLines).map(function(e){return parseInt(e,10)}).filter(function(e){return e}).map(function(e){return e})),tracer.sendTransformedFile({id:c,parentFilePath:a&&a.path,transformed:_.omit(s,"code"),instrumented:_.omit(g,"code","map"),lineMap:utils.updateFileMap({},s.map?[s.map,g.map]:[g.map]),ts:l.ts,originalTs:l.originalTs,matchSnapshotRanges:g.matchSnapshotRanges&&g.matchSnapshotRanges.length&&p?g.matchSnapshotRanges.map(function(e){return utils.mapTransformedRangeToOriginal(p,e)}):void 0,transformedTime:(new Date).toISOString()}),g.numberOfFunctions!==l.numberOfFunctions&&delete g.testName,l.test&&(!global.$_$traceContext||!global.$_$traceContext.test))if(g.testName&&l.allowedToRunSingleTestOnly){"*"===global.$_$tests&&(global.$_$tests={});var y=global.$_$tests[":?"]=global.$_$tests[":?"]||{};y[":"+g.testName]="*"}else global.$_$tests&&global.$_$tests[":?"]&&(global.$_$tests="*");var m=utils.docBlockComment(s.code).replace(/\r?\n|\r/g," ");m&&(g.code=m+g.code),s.code=g.code,delete s.map;for(var b=global.$_$coverage[c]=[],k=0;k<g.ranges.length;k++)b[k]={}}return s};if(e.process&&!e.process._wallabyExtended){var o=e.process;e.process=function(t,i,n,r){var a=o.call(e,t,i,n,r);return s(t,i,n,r,a)},e.process._wallabyExtended=!0}if(e.processAsync&&!e.processAsync._wallabyExtended){var a=e.processAsync;e.processAsync=function(t,i,n,r){return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(l){switch(l.label){case 0:return[4,a.call(e,t,i,n,r)];case 1:return o=l.sent(),[2,s(t,i,n,r,o)]}})})},e.processAsync._wallabyExtended=!0}return e._wallabyExtended=!0,e.transformer=e.transformer||{},e.transformer.getCacheKey=e.getCacheKey,e.transformer.process=e.process,e.transformer.getCacheKeyAsync=e.getCacheKeyAsync,e.transformer.processAsync=e.processAsync,e};return t?t&&!t._wallabyExtended?r(t):t:r({getCacheKey:function(e,t,i,n){return"string"!=typeof i&&(n=i,i=n.configString),crypto.createHash("md5").update(e).update(i).update(n&&n.instrument?"instrument":"").update(t).digest("hex")},process:function(e,t,i,n){return{code:null,map:null}}})},module.exports={init:function(e){return testFiles=e,{configure:function(e){testRunner||configure(e)["catch"](function(e){return console.error("Error while trying to configure jest: "+(e&&e.message||""))})}}}};